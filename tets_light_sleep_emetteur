#define BUTTON1 0 // D0 / GPIO0
#define BUTTON2 1 // D1 / GPIO1
#define BUTTON3 2 // D2 / GPIO2

#include "esp_sleep.h"

void setup() {
  Serial.begin(115200);
  delay(500);
  Serial.println("Setup start");

  // Configurer les boutons comme entrées avec pull-up
  pinMode(BUTTON1, INPUT_PULLUP);
  pinMode(BUTTON2, INPUT_PULLUP);
  pinMode(BUTTON3, INPUT_PULLUP);

  // Configurer les broches pour réveiller depuis le light sleep
  gpio_wakeup_enable((gpio_num_t)BUTTON1, GPIO_INTR_LOW_LEVEL);
  gpio_wakeup_enable((gpio_num_t)BUTTON2, GPIO_INTR_LOW_LEVEL);
  gpio_wakeup_enable((gpio_num_t)BUTTON3, GPIO_INTR_LOW_LEVEL);

  Serial.println("Entering light sleep...");

  // Entrer en light sleep
  esp_light_sleep_start();

  // Dès qu’on se réveille
  Serial.println("Woke up from light sleep!");

  if (digitalRead(BUTTON1) == LOW) Serial.println("Button 1 pressed");
  if (digitalRead(BUTTON2) == LOW) Serial.println("Button 2 pressed");
  if (digitalRead(BUTTON3) == LOW) Serial.println("Button 3 pressed");

  Serial.println("Setup complete");
}

void loop() {
  // Rester actif pour test
  delay(1000);
  Serial.println("Loop running, press a button to sleep again...");
  
  // Réentrer en light sleep
  esp_light_sleep_start();

  Serial.println("Woke up again!");
}
